<!DOCTYPE html>
<html>
<head>
    <title>–ò–≥—Ä–∞ MafiaGo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        .player-list {
            margin: 20px 0;
        }
        .player {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .player-name {
            font-weight: bold;
        }
        .player-status {
            padding: 2px 8px;
            border-radius: 4px;
        }
        .ready {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .not-ready {
            background-color: #f2dede;
            color: #a94442;
        }
        .ready-btn {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .ready-btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ö–æ–º–Ω–∞—Ç–∞: <span id="roomID">{{.RoomID}}</span></h1>
        <h2>–í–∞—à –Ω–∏–∫: <span id="nickname">{{.Nickname}}</span></h2>
        
        <div class="player-list" id="players">
            <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>
        
        <button id="readyBtn" class="ready-btn">–ù–µ –≥–æ—Ç–æ–≤</button>

        <div id="gameControls" style="display: none;">
            <button id="startGameBtn" class="start-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>

        <div id="roleInfo" style="display: none;">
            <h3>–í–∞—à–∞ —Ä–æ–ª—å: <span id="playerRole"></span></h3>
            <div id="roleDescription"></div>
        </div>
    </div>

    <script>
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ WebSocket —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º WSS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è Render)
        const socket = new WebSocket(`wss://${window.location.host}/ws?roomID=${encodeURIComponent("{{.RoomID}}")}&nickname=${encodeURIComponent("{{.Nickname}}")}`);
        
        const playersDiv = document.getElementById("players");
        const readyBtn = document.getElementById("readyBtn");
        let isReady = false;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
        readyBtn.addEventListener("click", () => {
            isReady = !isReady;
            readyBtn.textContent = isReady ? "–ì–æ—Ç–æ–≤" : "–ù–µ –≥–æ—Ç–æ–≤";
            readyBtn.style.backgroundColor = isReady ? "#4CAF50" : "#f44336";
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            socket.send(JSON.stringify({
                type: "player_ready",
                ready: isReady
            }));
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            if (data.type === "players_update") {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
                playersDiv.innerHTML = "";
                
                data.players.forEach(player => {
                    const playerElement = document.createElement("div");
                    playerElement.className = "player";
                    
                    playerElement.innerHTML = `
                        <span class="player-name">${player.nickname}</span>
                        <span class="player-status ${player.ready ? 'ready' : 'not-ready'}">
                            ${player.ready ? '‚úì –ì–æ—Ç–æ–≤' : '‚úó –ù–µ –≥–æ—Ç–æ–≤'}
                        </span>
                    `;
                    
                    playersDiv.appendChild(playerElement);
                });
            }
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        socket.onerror = (error) => {
            console.error("WebSocket error:", error);
            alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.");
        };

        // –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        socket.onclose = () => {
            console.log("WebSocket connection closed");
        };

        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            if (data.type === "players_update") {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
                updatePlayersList(data.players);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å—Ç–∞—Ä—Ç–∞
                const gameControls = document.getElementById("gameControls");
                const startBtn = document.getElementById("startGameBtn");
                
                if (data.canStart && "{{.Nickname}}" === data.players.find(p => p.isCreator)?.nickname) {
                    gameControls.style.display = "block";
                    startBtn.onclick = () => {
                        socket.send(JSON.stringify({ type: "start_game" }));
                    };
                } else {
                    gameControls.style.display = "none";
                }
                
                if (data.gameStarted) {
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω –∏–≥—Ä—ã
                    window.location.href = `/play?roomID=${encodeURIComponent("{{.RoomID}}")}&nickname=${encodeURIComponent("{{.Nickname}}")}`;
                }
            }

            if (data.type === "game_started") {
                document.getElementById("roleInfo").style.display = "block";
                document.getElementById("playerRole").textContent = getRoleName(data.role);
                document.getElementById("roleDescription").innerHTML = getRoleDescription(data.role);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–±–±–∏
                document.querySelector(".lobby-container").style.display = "none";
            }
        };

        function updatePlayersList(players) {
            const playersDiv = document.getElementById("players");
            playersDiv.innerHTML = "";
            
            players.forEach(player => {
                const playerElement = document.createElement("div");
                playerElement.className = "player";
                
                playerElement.innerHTML = `
                    <span class="player-name">
                        ${player.nickname} 
                        ${player.isCreator ? 'üëë' : ''}
                    </span>
                    <span class="player-status ${player.ready ? 'ready' : 'not-ready'}">
                        ${player.ready ? '‚úì –ì–æ—Ç–æ–≤' : '‚úó –ù–µ –≥–æ—Ç–æ–≤'}
                    </span>
                `;
                
                playersDiv.appendChild(playerElement);
            });
        }

        function getRoleName(role) {
            const roles = {
                "mafia_don": "–î–æ–Ω –º–∞—Ñ–∏–∏",
                "mafia": "–ú–∞—Ñ–∏—è",
                "sheriff": "–®–µ—Ä–∏—Ñ",
                "civilian": "–ú–∏—Ä–Ω—ã–π –∂–∏—Ç–µ–ª—å"
            };
            return roles[role] || role;
        }
        
        function getRoleDescription(role) {
            const descriptions = {
                "mafia_don": "–í—ã –≥–ª–∞–≤–∞ –º–∞—Ñ–∏–∏. –ù–æ—á—å—é –≤—ã –ø—Ä–æ—Å—ã–ø–∞–µ—Ç–µ—Å—å –≤–º–µ—Å—Ç–µ —Å –º–∞—Ñ–∏–µ–π –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ–± —É–±–∏–π—Å—Ç–≤–µ.",
                "mafia": "–í—ã —á–ª–µ–Ω –º–∞—Ñ–∏–∏. –ù–æ—á—å—é –≤—ã –ø—Ä–æ—Å—ã–ø–∞–µ—Ç–µ—Å—å –∏ –≤—ã–±–∏—Ä–∞–µ—Ç–µ –∂–µ—Ä—Ç–≤—É –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ –º–∞—Ñ–∏–æ–∑–∏.",
                "sheriff": "–í—ã —à–µ—Ä–∏—Ñ. –ù–æ—á—å—é –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –Ω–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∫ –º–∞—Ñ–∏–∏.",
                "civilian": "–í—ã –º–∏—Ä–Ω—ã–π –∂–∏—Ç–µ–ª—å. –í–∞—à–∞ —Ü–µ–ª—å - –≤—ã—á–∏—Å–ª–∏—Ç—å –∏ –ª–∏–Ω—á–µ–≤–∞—Ç—å –≤—Å–µ—Ö –º–∞—Ñ–∏–æ–∑–∏."
            };
            return descriptions[role] || "–û–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç";
        }
    </script>
</body>
</html>