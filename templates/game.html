<!DOCTYPE html>
<html>
<head>
    <title>–ò–≥—Ä–∞ MafiaGo</title>
</head>
<body>
    <div class="container">
        <h1>–ö–æ–º–Ω–∞—Ç–∞: <span id="roomID">{{.RoomID}}</span></h1>
        <h2>–í–∞—à –Ω–∏–∫: <span id="nickname">{{.Nickname}}</span></h2>
        
        <div id="players" class="players-list"></div>
        
        <button id="readyBtn" class="ready-btn">–ù–µ –≥–æ—Ç–æ–≤</button>
        <button id="startGameBtn" class="start-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>

    <script>
        const socket = new WebSocket(`wss://${window.location.host}/ws?roomID=${encodeURIComponent("{{.RoomID}}")}&nickname=${encodeURIComponent("{{.Nickname}}")}`);
        let isReady = false;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫ —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º
        function isCreator(players) {
            const currentNick = document.getElementById("nickname").textContent;
            const creator = players.find(p => p.isCreator);
            return creator && creator.nickname === currentNick;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
        function updatePlayersList(players) {
            const playersDiv = document.getElementById("players");
            playersDiv.innerHTML = "";
            
            players.forEach(player => {
                const playerElement = document.createElement("div");
                playerElement.className = "player";
                
                playerElement.innerHTML = `
                    <span class="player-name">
                        ${player.nickname}
                        ${player.isCreator ? '<span class="creator-icon">üëë</span>' : ''}
                    </span>
                    <span class="player-status ${player.ready ? 'ready' : 'not-ready'}">
                        ${player.ready ? '‚úì –ì–æ—Ç–æ–≤' : '‚úó –ù–µ –≥–æ—Ç–æ–≤'}
                    </span>
                `;
                playersDiv.appendChild(playerElement);
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            if (data.type === "players_update") {
                updatePlayersList(data.players);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É" –µ—Å–ª–∏:
                // 1. –≠—Ç–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å –∫–æ–º–Ω–∞—Ç—ã
                // 2. –í—Å–µ –∏–≥—Ä–æ–∫–∏ –≥–æ—Ç–æ–≤—ã
                // 3. –ò–≥—Ä–æ–∫–æ–≤ 4 –∏–ª–∏ –±–æ–ª—å—à–µ
                const shouldShowStartBtn = isCreator(data.players) && 
                                        data.canStart && 
                                        data.players.length >= 4;
                
                document.getElementById("startGameBtn").style.display = 
                    shouldShowStartBtn ? "block" : "none";
            }
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById("readyBtn").addEventListener("click", () => {
            isReady = !isReady;
            const btn = document.getElementById("readyBtn");
            btn.textContent = isReady ? "–ì–æ—Ç–æ–≤" : "–ù–µ –≥–æ—Ç–æ–≤";
            btn.style.backgroundColor = isReady ? "#4CAF50" : "#f44336";
            
            socket.send(JSON.stringify({
                type: "player_ready",
                ready: isReady
            }));
        });

        document.getElementById("startGameBtn").addEventListener("click", () => {
            socket.send(JSON.stringify({
                type: "start_game"
            }));
        });
    </script>
</body>
</html>