<!DOCTYPE html>
<html>
<head>
    <title>–ò–≥—Ä–∞ MafiaGo</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>–ö–æ–º–Ω–∞—Ç–∞: <span id="roomID">{{.RoomID}}</span></h1>
        <h2>–í–∞—à –Ω–∏–∫: <span id="nickname">{{.Nickname}}</span></h2>
        
        <div id="players" class="players-list"></div>
        
        <button id="readyBtn" class="ready-btn">–ù–µ –≥–æ—Ç–æ–≤</button>
        <div id="gameControls" style="display: none;">
            <button id="startGameBtn" class="start-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>
    </div>

    <script>
        // –û–±—ä—è–≤–ª—è–µ–º socket –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
        const socket = new WebSocket(`wss://${window.location.host}/ws?roomID=${encodeURIComponent("{{.RoomID}}")}&nickname=${encodeURIComponent("{{.Nickname}}")}`);
        
        let isReady = false;
        const playersDiv = document.getElementById("players");
        const readyBtn = document.getElementById("readyBtn");
        const startBtn = document.getElementById("startGameBtn");
        const gameControls = document.getElementById("gameControls");

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
        readyBtn.addEventListener("click", () => {
            isReady = !isReady;
            readyBtn.textContent = isReady ? "–ì–æ—Ç–æ–≤" : "–ù–µ –≥–æ—Ç–æ–≤";
            readyBtn.style.backgroundColor = isReady ? "#4CAF50" : "#f44336";
            
            socket.send(JSON.stringify({
                type: "player_ready",
                ready: isReady
            }));
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ä—Ç–∞ –∏–≥—Ä—ã
        startBtn.addEventListener("click", () => {
            socket.send(JSON.stringify({
                type: "start_game"
            }));
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            if (data.type === "players_update") {
                updatePlayersList(data.players);
                
                if (data.canStart && isCreator(data.players)) {
                    gameControls.style.display = "block";
                } else {
                    gameControls.style.display = "none";
                }
            }
            
            if (data.type === "game_started") {
                showRoleInfo(data);
            }
        };

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫ —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º –∫–æ–º–Ω–∞—Ç—ã
        function isCreator(players) {
            const currentNickname = document.getElementById("nickname").textContent;
            const creator = players.find(p => p.isCreator);
            return creator && creator.nickname === currentNickname;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
        function updatePlayersList(players) {
            playersDiv.innerHTML = "";
            
            players.forEach(player => {
                const playerElement = document.createElement("div");
                playerElement.className = "player";
                
                playerElement.innerHTML = `
                    <span class="player-name">
                        ${player.nickname} 
                        ${player.isCreator ? 'üëë' : ''}
                    </span>
                    <span class="player-status ${player.ready ? 'ready' : 'not-ready'}">
                        ${player.ready ? '‚úì –ì–æ—Ç–æ–≤' : '‚úó –ù–µ –≥–æ—Ç–æ–≤'}
                    </span>
                `;
                
                playersDiv.appendChild(playerElement);
            });
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–æ–ª–∏
        function showRoleInfo(data) {
            const roleNames = {
                "mafia_don": "–î–æ–Ω –º–∞—Ñ–∏–∏",
                "mafia": "–ú–∞—Ñ–∏—è",
                "sheriff": "–®–µ—Ä–∏—Ñ",
                "civilian": "–ú–∏—Ä–Ω—ã–π –∂–∏—Ç–µ–ª—å"
            };
            
            const roleDescriptions = {
                "mafia_don": "–í—ã –≥–ª–∞–≤–∞ –º–∞—Ñ–∏–∏. –ù–æ—á—å—é –≤—ã –ø—Ä–æ—Å—ã–ø–∞–µ—Ç–µ—Å—å –≤–º–µ—Å—Ç–µ —Å –º–∞—Ñ–∏–µ–π –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ–± —É–±–∏–π—Å—Ç–≤–µ.",
                "mafia": "–í—ã —á–ª–µ–Ω –º–∞—Ñ–∏–∏. –ù–æ—á—å—é –≤—ã –ø—Ä–æ—Å—ã–ø–∞–µ—Ç–µ—Å—å –∏ –≤—ã–±–∏—Ä–∞–µ—Ç–µ –∂–µ—Ä—Ç–≤—É –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ –º–∞—Ñ–∏–æ–∑–∏.",
                "sheriff": "–í—ã —à–µ—Ä–∏—Ñ. –ù–æ—á—å—é –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –Ω–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∫ –º–∞—Ñ–∏–∏.",
                "civilian": "–í—ã –º–∏—Ä–Ω—ã–π –∂–∏—Ç–µ–ª—å. –í–∞—à–∞ —Ü–µ–ª—å - –≤—ã—á–∏—Å–ª–∏—Ç—å –∏ –ª–∏–Ω—á–µ–≤–∞—Ç—å –≤—Å–µ—Ö –º–∞—Ñ–∏–æ–∑–∏."
            };
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–±–±–∏
            document.querySelector(".container").innerHTML = `
                <h1>–ö–æ–º–Ω–∞—Ç–∞: <span>${document.getElementById("roomID").textContent}</span></h1>
                <h2>–í–∞—à –Ω–∏–∫: <span>${document.getElementById("nickname").textContent}</span></h2>
                <div class="role-info">
                    <h3>–í–∞—à–∞ —Ä–æ–ª—å: <span>${roleNames[data.role]}</span></h3>
                    <p>${roleDescriptions[data.role]}</p>
                    <p>–í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: ${data.playersCount}</p>
                    <p>–ú–∞—Ñ–∏—è: ${data.mafiaCount}</p>
                </div>
            `;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
        socket.onerror = (error) => {
            console.error("WebSocket error:", error);
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        socket.onclose = () => {
            console.log("WebSocket connection closed");
        };
    </script>
</body>
</html>